# 停止使用If-Else语句

读者们也许看过无数使用 If-Else 的教程，也有很多编程书籍把 If-Else 语句作为分支情况下的标准技术。

甚至有很多读者都已经默认使用 If-Else 了。但是，现在这一切都将画上句号，本文将介绍使用状态对象替代 If-Else.

如果当前编写的类中的方法需要根据状态的不同来改变实现方法，那么可以使用这种方法。如果不涉及到状态的改变，那么可以使用其他的方法。

也许有很多读者听说过状态模式，但是还是想了解这种模式是如何在生产模式下工作的。

对于那些仍然一头雾水的人来说，这里有一个非常简要的介绍：

> 使用 If-Else 语句只会不断的增加程序的复杂度，在不停增加的条件下
>
> 使用状态模式，你可以通过改变特定的状态对象来轻松地改变一个对象的行为

下面的代码已经是过去式了：

![Poor if-else statements](https://miro.medium.com/max/700/1*bLGhV7DJmTPcPklCenG6ww.png)

读者们之前应该还写过更复杂的分支情况，因为我之前就这么干过。

上面的分支逻辑其实不算很复杂，但是如果需要加入新的条件的话你会看见自己的程序代码爆掉。

当然肯定也会有读者认为创建新的类来代替分支语句非常的麻烦，那么可以立刻实践一下，这种方式简洁而又优雅。

更棒的是，除了  `“D”`  部分，它会让代码库更加可靠。

**好的，现在我知道了 If-Else 的代码非常的冗余，快点告诉我如何避免多余的分支代码. **

接下来本文将介绍如何在生产环境下替换 If-Else 语句，这是一个非常简单的例子，但这种方法在大型客户端的代码库中也被使用过。

下面先创建一个 `Booking` 类，其中包括几种状态。也有两个公有方法， `Accept()`  和 `Cancel()` 。

下图简单阐述了 booking 类的几种状态：

![img](https://miro.medium.com/max/700/1*BsaE08azoOE5HJDC3AhZlg.png)

从代码中重构分支逻辑有三个步骤:

1. 创建一个抽象的基类
2. 创建每个状态的实现类，这些类继承于基类
3. 在 `Booking` 类中添加私有的或者内部方法，这个方法接收状态基类为参数

**Demo**

首先创造会被继承的基类

![img](https://miro.medium.com/max/700/1*tk7VU1IXVacffxU268v9Pw.png)

注意这个基类也有两个方法，Accept和Cancel——尽管在这里它们被标记为internal。

此外，这个基态有一个特殊的 `EnterState(Booking booking)` 方法。每当给 `booking` 对象分配一个新状态时，就会调用这个函数。

其次，为每个状态设置单独的实现类。

![img](https://miro.medium.com/max/700/1*ormvF4PcmTFtvoAOdE93SA.png)

注意每个类是如何表示上面优雅的图中所描述的状态的。另外，`CancelledState` 不允许我们的 `booking` 转换到一个新的状态。这个类在本质上与空对象模式非常相似。

最后， `booking` 类本身：

![img](https://miro.medium.com/max/700/1*7o2BnmPzYNcHThF9OelHcg.png)

可以看出 `booking` 类非常优雅的实现了 `Accept`  状态和 `Cancel` 状态的转化。

这种处理办法可以让程序省去很多条件判断逻辑，每个状态只需要关注对它本身重要的问题 - 当前状态可以把 `booking` 类转化到新的状态。

**如何处理新的条件分支**

如果新特性通常是通过一些条件检查实现的，那么可以直接在代码中创建一个新的状态类。

就是这么简单，不需要处理新的 `If-Else` 逻辑。

**如何将状态对象持久化到数据库**

不需要。

当将对象保存到SQL或NoSQL数据库时，状态对象并不重要。只知道对象的状态以及如何将其映射到列是很重要的。

可以将状态映射到类型名称、枚举或整数。只要有办法将保存的值转换回状态对象，任何方法都是可以的。

**但是仍然会编写 `IF` 语句**

是的，它们是必不可少的。特别是用来处理异常条件时。`If- Else` 组合是造成可维护性问题的根本原因。

**这样会产生很多多余的类**

确实。正如另一篇文章中所提到的，复杂性并不来源于您所拥有的类的数量，而是这些类的用途。

拥有许多特定功能的类将使代码库更具可读性、可维护性，总体上更易于使用。

> 原文链接： https://medium.com/swlh/stop-using-if-else-statements-f4d2323e6e4?source=search_post---------0

